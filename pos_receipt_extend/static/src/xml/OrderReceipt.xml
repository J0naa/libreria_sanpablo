<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- ============================================================= -->
    <!-- ==================    HEADER FEL GUATEMALA    =============== -->
    <!-- ============================================================= -->
    <t t-name="pos_fel_receipt_header"
       t-inherit="point_of_sale.ReceiptHeader"
       t-inherit-mode="extension"
       owl="1">

        <!-- Reemplazar TODO el contenido del header -->
        <xpath expr="div" position="replace">

            <div class="pos-receipt">

                <!-- LOGO -->
                <t t-if="this.env.services.pos.company.logo">
                    <img t-att-src="this.env.services.pos.company.logo"
                         style="width: 30%; height: auto;"/>
                </t>

                <!-- DATOS EMPRESA -->
                <div style="text-align:center; font-size:12px; margin-top:4px;">

                    <div><t t-esc="this.env.services.pos.company.name"/></div>

                    <t t-if="this.env.services.pos.company.street">
                        <div><t t-esc="this.env.services.pos.company.street"/></div>
                    </t>

                    <t t-if="this.env.services.pos.company.phone">
                        <div>Tel: <t t-esc="this.env.services.pos.company.phone"/></div>
                    </t>

                    <t t-if="this.env.services.pos.company.vat">
                        <div>NIT: <t t-esc="this.env.services.pos.company.vat"/></div>
                    </t>
                </div>

                <!-- TÍTULO DEL DOCUMENTO -->
                <div style="text-align:center; font-weight:bold; margin-top:8px;">
                    DOCUMENTO TRIBUTARIO ELECTRÓNICO (DTE)
                </div>

                <!-- DATOS DTE (FEL) -->
                <t t-if="this.state.invoiceData">
                    <div style="font-size:12px; margin-top:6px;">
                        <div><b>Autorización:</b> <t t-esc="this.state.invoiceData.auth_number"/></div>
                        <div><b>Serie:</b> <t t-esc="this.state.invoiceData.dte_serie"/></div>
                        <div><b>Número DTE:</b> <t t-esc="this.state.invoiceData.dte_number"/></div>
                        <div><b>Fecha Envío:</b> <t t-esc="this.state.invoiceData.fecha_envio"/></div>
                    </div>
                </t>

                <!-- CLIENTE -->
                <t t-if="this.env.services.pos.selectedOrder.partner">
                    <div style="font-size:12px; margin-top:6px;">

                        <div><b>Cliente:</b> <t t-esc="this.env.services.pos.selectedOrder.partner.name"/></div>

                        <t t-if="this.env.services.pos.selectedOrder.partner.vat">
                            <div><b>NIT:</b> <t t-esc="this.env.services.pos.selectedOrder.partner.vat"/></div>
                        </t>

                    </div>
                </t>

            </div>

        </xpath>
    </t>



    <!-- ============================================================= -->
    <!-- ====================     BODY / LÍNEAS     ================== -->
    <!-- ============================================================= -->
    <t t-name="pos_fel_receipt_body"
       t-inherit="point_of_sale.ReceiptBody"
       t-inherit-mode="extension"
       owl="1">

        <!-- Reemplazar tabla completa -->
        <xpath expr="table" position="replace">

            <table style="width:100%; font-size:12px; margin-top:10px;">

                <tr style="border-bottom:1px solid black;">
                    <th style="text-align:left;">Producto</th>
                    <th style="text-align:center;">Cant.</th>
                    <th style="text-align:right;">Subtotal</th>
                </tr>

                <t t-foreach="this.props.orderlines" t-as="line" t-key="line.cid">
                    <tr>
                        <td><t t-esc="line.get_product().display_name"/></td>
                        <td style="text-align:center;"><t t-esc="line.get_quantity_str_with_unit()"/></td>
                        <td style="text-align:right;"><t t-esc="this.env.utils.formatCurrency(line.get_display_price())"/></td>
                    </tr>
                </t>

            </table>

        </xpath>
    </t>



    <!-- ============================================================= -->
    <!-- =======================    FOOTER      ======================= -->
    <!-- ============================================================= -->
    <t t-name="pos_fel_receipt_footer"
       t-inherit="point_of_sale.ReceiptFooter"
       t-inherit-mode="extension"
       owl="1">

        <!-- Reemplazar contenido del footer -->
        <xpath expr="div" position="replace">

            <div style="font-size:12px; margin-top:10px;">

                <!-- TOTAL -->
                <div>
                    <b>Total:</b>
                    <span style="float:right;">
                        <t t-esc="this.env.utils.formatCurrency(this.props.receipt.amount_total)"/>
                    </span>
                </div>

                <!-- CAMBIO -->
                <div>
                    <b>Cambio:</b>
                    <span style="float:right;">
                        <t t-esc="this.env.utils.formatCurrency(this.props.receipt.change)"/>
                    </span>
                </div>

                <!-- DIGIFACT (FEL GUATEMALA) -->
                <div style="text-align:center; font-size:12px; margin-top:12px;">
                    Documento validado por<br/>
                    <b>DIGIFACT</b><br/>
                    Proveedor Autorizado Calificado
                </div>

                <div style="text-align:center; font-size:12px; margin-top:15px;">
                    ¡Gracias por su compra!
                </div>

            </div>

        </xpath>
    </t>

</templates>
